@startuml
'https://plantuml.com/class-diagram
skinparam classAttributeIconSize 0
!pragma layout smetana

class Webserver {
- {static} PORT :int
- {static} FORMATTER : DateTimeFormatter
+ Webserver()
}

class SocketThread {
- insocked : Socked
- makeRequest(tokens : String[]) : Request
- makeRequestReader(tokens : String[]) : RequestReader
- makeRequestArea(tokens : String[]) : RequestArea
- makeHeaderAnswer() : String
- makeJsonAnswer(request : Request) : String
+ run()
}

Webserver +-right- SocketThread

note right of SocketThread
inner class
of Webserver
end note

class DirectoryAreas
{
{static}-rootArea: Area
{static}-allDoors: Door[]
{static}+makeAreas()
{static}+findAreaById(id : String) : Area
{static}-findDoorsByIds(ids : String[]) : Door[]
{static}+findDoorById(id : String) : Door
{static}+getAllDoors() : Door[]
}

DirectoryAreas --> "*" Area : "rootArea"

class DirectoryDoors {
- {static} allDoors : Door[]
+ {static} makeDoors()
+ {static} findDoorById(id : String) : Door
+ {static} getAllDoors() : Door[]
}

DirectoryDoors --> "*" Door : "allDoors"

class DirectoryUsers {
- {static} users : User[]
+ {static} makeUsers()
+ {static} findUserByCredential(credential : String) : User
}

DirectoryUsers --> "*" User : "users"

class Door {
- id : String
- closed : boolean
- currentState : DoorState
+ Door(id : String, Space : fromSpace, Space : toSpace)
+ processRequest(request : RequestReader)
+ toJson() : JSONObject

'+ toString() : String
'+ isClosed() :boolean
'+ setClosed(b : boolean)
'+ getStateName() : String

}


class User {
- name : String
- credential : String
+ User(name: String, credential: String)
+ toString() : String
}


class Main {
+ {static} main(args : String)
}

abstract DoorState{
# door : Door
# name : String
+ DoorState(door : Door)
{abstract}+ open()
{abstract}+ close()
{abstract}+ lock()
{abstract}+ unlock()
{abstract}+ unlockShortly()
{abstract}+ prop()
}

class Locked extends DoorState{
+ DoorState(door : Door)
{abstract}+ open()
{abstract}+ close()
{abstract}+ lock()
{abstract}+ unlock()
{abstract}+ unlockShortly()
{abstract}+ prop()
}

class Unlocked extends DoorState{
+ changeState(action : String) : DoorState
}

class UnlockedShortly extends DoorState{
+ changeState(action : String) : DoorState
}

class Propped extends DoorState{
+ changeState(action : String) : DoorState
}

abstract Area{
#id : String
#name : String
#parent: Area
{abstract}+ getSpaces() : Space[]
{abstract}+ getDoorsGivingAccess() : Door[]
{abstract}+ findAreaById(id : String) : Area
}

class Space extends Area{
- doors : Door[]
+ getSpaces() : Space[]
+ getDoorsGivingAccess() : Door[]
+ findAreaById(id : String) : Area
}

class Partition extends Area{
- areas : Area[]
+ getSpaces() : Space[]
+ getDoorsGivingAccess() : Door[]
+ findAreaById(id : String) : Area
}

note right of Main::main
DirectoryDoors.makeDoors()
DiretoryUsers.makeUsers()
new Webserver()
end note

Main -[hidden]down- Webserver
Webserver -[hidden]down- DirectoryDoors
DirectoryDoors -[hidden]right- DirectoryUsers
Door -->"1" DoorState : currentState
Partition *-->"*" Area : areas
Space -->"*" Door : doors
@enduml
